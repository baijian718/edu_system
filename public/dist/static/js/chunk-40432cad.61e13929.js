(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40432cad"],{"0349":function(e,t,n){},"1f35":function(e,t,n){"use strict";var r=n("40b9");t["a"]=r["default"]},"21fa":function(e,t,n){},"29b9":function(e,t,n){},"40b9":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",[n("div",[n("a-space",{staticClass:"operator"},[n("a-button",{attrs:{type:"primary"},on:{click:e.addNew}},[e._v("新增账单")])],1),n("a-modal",{attrs:{visible:e.createCourseFormVisible,width:600,title:"新增账单",footer:null},on:{cancel:e.closeAdd}},[n("AddInvoice",{ref:"AddInvoice",attrs:{visible:e.createCourseFormVisible,action_type:e.actionType,width:600},on:{"close-dialog":e.closeAdd,success:e.reload}})],1),n("standard-table",{attrs:{columns:e.columns,dataSource:e.dataSource,rowKey:e.rowKey,selectedRows:e.selectedRows,pagination:Object.assign({},e.pagination,{onChange:e.onPageChange})},on:{"update:selectedRows":function(t){e.selectedRows=t},"update:selected-rows":function(t){e.selectedRows=t}},scopedSlots:e._u([{key:"description",fn:function(t){var r=t.text;return n("div",{},[e._v(" "+e._s(r)+" ")])}},{key:"action",fn:function(t){t.text;var r=t.record;return 1===r.invoice_status?n("div",{},[n("a-popconfirm",{attrs:{title:e.$t("deleteConfirm")},on:{confirm:function(t){return e.invoiceSend(r.id)}}},[n("a",{attrs:{"a-icon":"",type:"delete"}},[e._v(e._s(e.$t("delete")))])])],1):e._e()}}],null,!0)})],1)])},a=[],i=(n("4de4"),n("c740"),n("b680"),n("3521")),s=n("b775"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",{attrs:{"body-style":{width:"600px"},bordered:!1}},[n("a-form",{ref:"form"},[n("a-form-item",{attrs:{label:e.$t("course_name"),labelCol:{span:7,style:{paddingTop:"10px"}},wrapperCol:{span:10}}},[n("CourseSelect",{ref:"CourseSelect",model:{value:e.selectCourseValue,callback:function(t){e.selectCourseValue=t},expression:"selectCourseValue"}})],1),n("a-form-item",{attrs:{label:e.$t("student_name"),labelCol:{span:7,style:{paddingTop:"10px"}},wrapperCol:{span:10}}},[n("StudentSelect",{ref:"studentSelect",attrs:{students:e.students},model:{value:e.selectStudentValue,callback:function(t){e.selectStudentValue=t},expression:"selectStudentValue"}})],1),n("a-form-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{span:10,offset:10}}},[n("a-button",{attrs:{type:"primary",disabled:e.isSubmitDisabled},on:{click:e.submitForm}},[e._v(e._s(e.$t("submit")))])],1)],1)],1)},u=[],c=(n("4160"),n("159b"),n("3af3")),d=n("3042"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-select",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px","margin-right":"8px"},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}},e._l(e.students,(function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)},f=[],p=(n("a434"),n("b0c0"),n("a9e3"),n("3f45")),m={name:"StudentSelect",props:{students:{type:Array,required:!0,default:function(){return[]}},value:{type:[String,Number],required:!0},filterConditions:{type:Object,default:function(){return{}}}},computed:{selectedValue:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}},methods:{getStudent:function(e){if(this.students.length>0)return this.students;var t=this;return Object(p["a"])("",e).then((function(e){var n=e.data;n.code>0?this.error=n.message:n.data.forEach((function(e){t.students.push({id:e.id,name:e.name})}))})),this.students},reset:function(e){this.students.splice(0,this.students.length),this.getStudent(e)}}},h=m,v=(n("b53f"),n("2877")),b=Object(v["a"])(h,l,f,!1,null,"d17ff1b0",null),g=b.exports,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-select",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px","margin-right":"8px"},model:{value:e.selectedValue,callback:function(t){e.selectedValue=t},expression:"selectedValue"}},e._l(e.courses,(function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id}},[e._v(" "+e._s(t.name)+" ")])})),1)},S=[],y=(n("a623"),n("b64b"),{name:"CourseSelect",props:{courses:{type:Array,default:function(){return[]}},value:{type:[String,Number],required:!0},filterConditions:{type:Object,default:function(){return{}}}},mounted:function(){this.getCourses()},computed:{selectedValue:{get:function(){return this.value},set:function(e){this.$emit("input",e)}},filteredCourses:function(){var e=this;return this.courses.filter((function(t){return Object.keys(e.filterConditions).every((function(n){return t[n]===e.filterConditions[n]}))}))}},methods:{getCourses:function(){if(this.courses.length>0)return this.courses;var e=this;return Object(d["c"])("").then((function(t){var n=t.data;n.code>0?this.error=n.message:n.data.forEach((function(t){e.courses.push({id:t.id,name:t.name})}))})),this.courses}}}),w=y,C=(n("8641"),Object(v["a"])(w,_,S,!1,null,"24018e91",null)),x=C.exports,V=n("f81a"),I={components:{StudentSelect:g,CourseSelect:x,"a-form":c["a"],"a-form-item":c["a"].Item},props:{action_type:{type:String,required:!0,default:"create"}},name:"AddInvoice",i18n:n("d18f"),data:function(){return{visible:!1,form:this.$form.createForm(this,{name:"add_course"}),formFields:{course_sn:"",course_name:"",course_fee:null,course_month:null,course_month_str:""},isSubmitting:!1,students:[],selectCourseValue:"",selectStudentValue:""}},watch:{selectCourseValue:{immediate:!0,handler:function(e){this.getStudent(e)}}},computed:{isSubmitDisabled:function(){return this.isSubmitting||!(this.selectCourseValue&&this.selectStudentValue)}},methods:{submitForm:function(){var e=this;this.form.validateFields((function(t){t||e.createInvoice(e.selectCourseValue,e.selectStudentValue,"")}))},createInvoice:function(e,t,n){var r=this;r.isSubmitting=!0,Object(V["a"])(e,t,n).then((function(e){r.isSubmitting=!1,e.data.code>0?r.$message.error(e.data.message):(r.$message.success(e.data.message),r.$emit("success"),r.$emit("close-dialog"))}))},getStudent:function(e){var t=this;Object(d["d"])(e).then((function(e){var n=e.data;if(n.code>0)t.error=n.message;else{var r=[];n.data.forEach((function(e){r.push(e.id)})),t.$refs.studentSelect.reset(r)}}))},clear:function(){this.form.resetFields(),this.selectCourseValue="",this.selectStudentValue=""}},mounted:function(){}},$=I,k=(n("4419"),Object(v["a"])($,o,u,!1,null,"31c26fe5",null)),O=k.exports,j=n("1f35"),R=[{title:"账单Id",dataIndex:"id"},{title:"课程编号",dataIndex:"course_sn"},{title:"课程月份",dataIndex:"course_year_month"},{title:"课程名称",dataIndex:"course_name"},{title:"账单费用",dataIndex:"fee",customRender:function(e){return(e/100).toFixed(2)+"元"}},{title:"学生姓名",dataIndex:"student_name"},{title:"学生编号",dataIndex:"student_sn"},{title:"账单状态",dataIndex:"invoice_status",customRender:function(e){switch(e){case 1:return"待发送";case 2:return"待支付";case 3:return"已支付";default:return"未知状态"}},sorter:!0},{title:"账单时间",dataIndex:"create_at",sorter:!0},{title:"操作",scopedSlots:{customRender:"action"}}],F={name:"InvoiceList",computed:{invoice:function(){return j["a"]},form:function(){return this.$form.createForm(this,{name:"add_invoice"})}},i18n:n("75b7"),components:{AddInvoice:O,StandardTable:i["a"]},data:function(){return{advanced:!0,columns:R,rowKey:"id",dataSource:[],selectedRows:[],pagination:{current:1,pageSize:10,total:0},createCourseFormVisible:!1,createStudentFormVisible:!1,actionType:"create"}},authorize:{deleteRecord:"delete"},mounted:function(){this.load()},methods:{load:function(){var e=this;Object(s["f"])("https://poper-ops-interview-02.herokuapp.com/api/invoice/teacher-list","get",{page:this.pagination.current,pageSize:this.pagination.pageSize}).then((function(t){var n,r,a=null!==(n=null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r.data)&&void 0!==n?n:{},i=a.list,s=a.page,o=a.pageSize,u=a.total;e.dataSource=i,e.pagination.current=s,e.pagination.pageSize=o,e.pagination.total=u}))},reload:function(){this.load()},remove:function(){var e=this;this.dataSource=this.dataSource.filter((function(t){return-1===e.selectedRows.findIndex((function(e){return e.key===t.key}))})),this.selectedRows=[]},addNew:function(){var e=this;this.createCourseFormVisible=!0,this.$nextTick((function(){e.$refs.AddInvoice&&"function"===typeof e.$refs.AddInvoice.clear&&e.$refs.AddInvoice.clear()}))},onPageChange:function(e,t){this.pagination.current=e,this.pagination.pageSize=t,this.load()},closeAdd:function(){this.createCourseFormVisible=!1},invoiceSend:function(e){var t=this;Object(V["c"])(e).then((function(e){0===e.data.code?(t.$message.success(e.data.message),t.reload()):t.$message.error(e.data.message)}))},toggle:function(e){var t=this.dataSource.filter((function(t){return t.key===e}))[0];t.editable=!t.editable}}},A=F,T=(n("d926"),Object(v["a"])(A,r,a,!1,null,"4893b609",null));t["default"]=T.exports},4419:function(e,t,n){"use strict";var r=n("0349"),a=n.n(r);a.a},"75b7":function(e,t){e.exports={messages:{CN:{delete:"发送",deleteConfirm:"确认需要发送账单给该学生么"}}}},8641:function(e,t,n){"use strict";var r=n("21fa"),a=n.n(r);a.a},"8ba7":function(e,t,n){},a623:function(e,t,n){"use strict";var r=n("23e7"),a=n("b727").every,i=n("a640"),s=n("ae40"),o=i("every"),u=s("every");r({target:"Array",proto:!0,forced:!o||!u},{every:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},b53f:function(e,t,n){"use strict";var r=n("8ba7"),a=n.n(r);a.a},d18f:function(e,t){e.exports={messages:{CN:{course_sn:"课程编号",course_name:"课程名称",student_name:"学生姓名",course_fee:"课程费用",course_month:"课程年月",course_name_placeholder:"请输入课程编号",course_sn_placeholder:"请输入课程标号",course_fee_placeholder:"请输入课程费用",course_month_placeholder:"请选择课程年月",submit:"保存",cancel:"取消",save:"取消"}}}},d926:function(e,t,n){"use strict";var r=n("29b9"),a=n.n(r);a.a},f81a:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return d}));n("96cf");var r=n("1da1"),a=n("7424"),i=n("b775");function s(e,t,n){return o.apply(this,arguments)}function o(){return o=Object(r["a"])(regeneratorRuntime.mark((function e(t,n,r){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s={course_id:t,student_id:n},r.length>0&&(s.remark=r),e.abrupt("return",Object(i["f"])(a["InvoiceCreate"],i["a"].POST,s));case 3:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return c=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={invoice_id:t},e.abrupt("return",Object(i["f"])(a["InvoiceSendUri"],i["a"].POST,n));case 2:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e){return l.apply(this,arguments)}function l(){return l=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={invoice_id:t},e.abrupt("return",Object(i["f"])(a["InvoiceCreatePayUri"],i["a"].POST,n));case 2:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}}}]);