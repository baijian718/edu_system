(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-903523d0"],{"2f12":function(t,e,a){"use strict";var n=a("3b0c"),s=a.n(n);s.a},"35a4":function(t,e){t.exports={messages:{CN:{add:"添加",delete:"删除",save:"保存",cancel:"取消",edit:"编辑",deleteConfirm:"是否要删除此行？",newMember:"新增成员",table:{key:"学生ID",name:"学生姓名",number:"学生工号",operation:"操作"},manager:"谁"}}}},"3aa9":function(t,e,a){"use strict";var n=a("4cec"),s=a.n(n);s.a},"3b0c":function(t,e,a){},"4cec":function(t,e,a){},5214:function(t,e,a){},9634:function(t,e){t.exports={messages:{CN:{course_sn:"课程编号",course_name:"课程名称",course_fee:"课程费用",course_month:"课程年月",course_name_placeholder:"请输入课程名称",course_sn_placeholder:"请输入课程编号",course_fee_placeholder:"请输入课程费用",course_month_placeholder:"请选择课程年月",submit:"保存",cancel:"取消",save:"取消"}}}},"97ab":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"custom-card"},[a("div",[a("a-space",{staticClass:"operator"},[a("a-button",{attrs:{type:"primary"},on:{click:t.addNew}},[t._v("新增课程")])],1),a("a-modal",{attrs:{visible:t.createCourseFormVisible,width:600,title:"新增课程",footer:null},on:{cancel:t.courseCreateClose}},[a("AddCourse",{ref:"addCourse",attrs:{visible:t.createCourseFormVisible,width:600},on:{close:t.courseCreateClose,success:t.addCourseSuccess}})],1),a("CourseListView",{attrs:{columns:t.columns,dataSource:t.dataSource,rowKey:t.rowKey,pagination:Object.assign({},t.pagination,{onChange:t.onPageChange})},on:{change:t.onPageChange}})],1)])},s=[],i=(a("4de4"),a("c740"),a("b680"),a("b775")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-card",{attrs:{"body-style":{padding:"24px 32px",width:"600px"},bordered:!1}},[a("a-form",{ref:"form"},[a("a-form-item",{attrs:{label:t.$t("course_sn"),labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:t.$t("course_sn_placeholder")},model:{value:t.formData.course_sn,callback:function(e){t.$set(t.formData,"course_sn",e)},expression:"formData.course_sn"}})],1),a("a-form-item",{attrs:{label:t.$t("course_name"),labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input",{attrs:{placeholder:t.$t("course_name_placeholder")},model:{value:t.formData.course_name,callback:function(e){t.$set(t.formData,"course_name",e)},expression:"formData.course_name"}})],1),a("a-form-item",{attrs:{label:t.$t("course_fee"),labelCol:{span:7},wrapperCol:{span:10}}},[a("a-input-number",{staticClass:"input-number-width",attrs:{placeholder:t.$t("course_fee_placeholder")},model:{value:t.formData.course_fee,callback:function(e){t.$set(t.formData,"course_fee",e)},expression:"formData.course_fee"}})],1),a("a-form-item",{attrs:{label:t.$t("course_month"),labelCol:{span:7},wrapperCol:{span:10}}},[a("a-month-picker",{ref:"course_month",staticStyle:{width:"100%"},attrs:{format:"YYYY-MM"},model:{value:t.formData.course_month,callback:function(e){t.$set(t.formData,"course_month",e)},expression:"formData.course_month"}})],1),a("a-form-item",{staticStyle:{"margin-top":"24px"},attrs:{wrapperCol:{span:10,offset:7}}},[a("a-button",{attrs:{type:"primary",disabled:t.isSubmitDisabled},on:{click:t.submitForm}},[t._v(t._s(t.$t("submit")))]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.close}},[t._v(t._s(t.$t("save")))])],1)],1)],1)},r=[],c=a("3af3"),u=a("b558"),d=a("3042"),l={components:{"a-form":c["a"],"a-input":u["a"],"a-form-item":c["a"].Item},props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:function(){return{course_sn:"",course_name:"",course_fee:null,course_month:null}}}},name:"AddCourse",i18n:a("9634"),data:function(){return{form:this.$form.createForm(this,{name:"add_course"}),formFields:{course_sn:"",course_name:"",course_fee:null,course_month:null,course_month_str:""},isSubmitting:!1}},watch:{},computed:{desc:function(){return this.$t("pageDesc")},isSubmitDisabled:function(){return this.isSubmitting||!(this.formData.course_sn&&this.formData.course_name&&this.formData.course_fee&&this.formData.course_month)}},methods:{submitForm:function(t){var e=this;t.preventDefault();var a=this;this.form.validateFields((function(t){if(!t){var n=e.formData.course_name,s=e.formData.course_sn,i="";e.formData.course_month&&(i=e.formData.course_month.format("YYYYMM"));var o=e.formData.course_fee;a.isSubmitting=!0,Object(d["e"])(s,n,i,o).then((function(t){a.isSubmitting=!1,0===t.data.code?(a.$message.success(t.data.message),a.$emit("success"),a.$emit("close")):a.$message.error(t.data.message)}))}}))},close:function(){this.$emit("close")},open:function(){this.$set(this.formData,"course_month",0),this.$set(this.formData,"course_sn",""),this.$set(this.formData,"course_name",""),this.$set(this.formData,"course_fee",null)}},mounted:function(){}},m=l,f=(a("dd34"),a("2877")),h=Object(f["a"])(m,o,r,!1,null,"8d009940",null),p=h.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"table-container"},[a("table",{staticClass:"table"},[a("thead",[a("tr",t._l(t.columns,(function(e){return a("th",{key:e.dataIndex,style:{width:e.width}},[t._v(t._s(e.title))])})),0)]),a("tbody",t._l(t.dataSource,(function(e){return a("tr",{key:e.id},t._l(t.columns,(function(n){return a("td",{key:n.dataIndex,style:{width:n.width}},["action"===n.dataIndex?[a("div",[a("a",{staticStyle:{"margin-right":"8px"},on:{click:function(a){return t.addStudent(e.id)}}},[a("a-icon",{attrs:{type:"plus"}}),t._v(" 学生管理 ")],1)])]:"fee"===n.dataIndex?[t._v(" "+t._s(e[n.dataIndex]/100)+" ")]:[a("div",{staticClass:"ellipsis",attrs:{title:e[n.dataIndex]}},[t._v(" "+t._s(e[n.dataIndex])+" ")])]],2)})),0)})),0)]),a("div",{staticClass:"pagination"},[a("button",{staticClass:"prev",class:{disabled:t.isPrevDisabled},attrs:{disabled:t.isPrevDisabled},on:{click:t.prevPage}},[a("span",{staticClass:"icon"},[t._v("上一页")])]),t._l(t.displayedPages,(function(e){return a("span",{key:e,class:["page",{"current-page":e===t.pagination.current}],on:{click:function(a){return t.goToPage(e)}}},[t._v(" "+t._s(e)+" ")])})),a("button",{staticClass:"next",class:{disabled:t.isNextDisabled},attrs:{disabled:t.isNextDisabled},on:{click:t.nextPage}},[a("span",{staticClass:"icon"},[t._v("下一页")])])],2),a("a-modal",{attrs:{visible:t.createStudentFormVisible,width:800,title:"学生管理",footer:null},on:{cancel:t.addStudentClose}},[a("AddStudent",{ref:"addStudent",attrs:{visible:t.createStudentFormVisible,width:600},on:{success:t.reload,close:t.addStudentClose}})],1)],1)},g=[],_=a("5530"),S=function(){var t=this,e=this,a=e.$createElement,n=e._self._c||a;return n("form",{attrs:{autoFormCreate:function(e){return t.form=e}}},[n("a-table",{attrs:{columns:e.dataColumns,dataSource:e.dataSource,pagination:!1},scopedSlots:e._u([{key:"operation",fn:function(t,a){return[n("a-popconfirm",{attrs:{title:e.$t("deleteConfirm")},on:{confirm:function(t){return e.remove(a.key)}}},[n("a",[e._v(e._s(e.$t("delete")))])])]}}])}),n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("a-select",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px","margin-right":"8px"},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.students,(function(t){return n("a-select-option",{key:t.id,attrs:{value:t.id,disabled:t.disabled}},[e._v(" "+e._s(t.name)+" ")])})),1),n("a-button",{staticStyle:{width:"100%","margin-top":"16px","margin-bottom":"8px"},attrs:{type:"dashed",icon:"plus",disable:e.isSubmittingComputed},on:{click:e.addStudent}},[e._v(e._s(e.$t("newMember")))])],1)],1)},v=[],C=(a("4160"),a("caad"),a("d81d"),a("a434"),a("b0c0"),a("2532"),a("159b"),a("2909")),y=a("3f45"),x=[{title:"学生ID",dataIndex:"key",key:"key",width:"20%",scopedSlots:{customRender:"id"}},{title:"学生编号",dataIndex:"number",key:"number",width:"20%",scopedSlots:{customRender:"number"}},{title:"学生姓名",dataIndex:"name",key:"name",width:"20%",scopedSlots:{customRender:"name"}},{title:"操作",key:"operation",scopedSlots:{customRender:"operation"}}],w={name:"AddStudent",i18n:a("35a4"),data:function(){return{columns:x,dataSource:[],students:[],selectValue:null,selectData:[],selectFetching:!1,selectedStudentId:[],courseId:0,isSubmitting:!1}},computed:{dataColumns:function(){var t=this;return this.columns.map((function(e){return e.title=t.$t("table."+e.key),e}))},isSubmittingComputed:function(){return this.isSubmitting||!this.selectValue}},mounted:function(){this.students.length=0,this.dataSource.length=0,Object(y["a"])("",[]).then(this.storeStudentSelect)},methods:{storeStudentSelect:function(t){var e=t.data;if(0===e.code)for(var a in e.data)this.students.push({id:e.data[a].id,sn:e.data[a].sn,name:e.data[a].name,disabled:!1});else this.$message.error(e.message)},addStudent:function(){var t=this.selectValue,e=this;return!!this.selectedStudentId.includes(t)||!!this.selectValue&&void Object(d["a"])(this.courseId,t).then((function(a){a.data.code>0?e.$message.error(a.data.message):(e.students.forEach((function(a){if(a.id===t)return e.dataSource.push({key:t,name:a.name,number:a.sn}),a.disabled=!0,!0})),e.selectValue=null)}))},remove:function(t){var e=this;Object(d["b"])(this.courseId,t).then((function(a){a.data.code>0?e.$message.error(a.data.message):(e.students.forEach((function(e){e.id===t&&(e.disabled=!1)})),e.dataSource=e.dataSource.filter((function(e){return e.key!==t})),e.selectedStudentId=e.selectedStudentId.filter((function(e){return e!==t})))}))},toggle:function(t){var e=this.dataSource.filter((function(e){return e.key===t}))[0];e.editable=!e.editable},handleChange:function(t,e,a){var n=Object(C["a"])(this.dataSource),s=n.filter((function(t){return e===t.key}))[0];s&&(s[a]=t,this.dataSource=n)},makeData:function(t){this.courseId=t,this.selectedStudentId.length=0,this.dataSource.splice(0,this.dataSource.length),this.selectFetching=!1;var e=this;e.students.forEach((function(t){t.disabled=!1})),Object(d["d"])(t).then((function(t){t.data.code>0?e.$message.error("数据异常"):t.data.data.forEach((function(t){e.selectedStudentId.push(t.id),e.dataSource.push({name:t.name,number:t.sn,key:t.id}),e.students.forEach((function(e){e.id===t.id&&(e.disabled=!0)}))}))}))}}},D=w,$=Object(f["a"])(D,S,v,!1,null,"488cde10",null),k=$.exports,I={name:"CourseListView",components:{AddStudent:k},props:{dataSource:{type:Array,default:function(){return[]}},columns:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){return{current:1,pageSize:10,total:0}}}},data:function(){return{createStudentFormVisible:!1}},computed:{displayedPages:function(){for(var t=this.pagination,e=t.current,a=t.total,n=t.pageSize,s=2,i=Math.max(1,e-s),o=Math.min(Math.ceil(a/n),e+s),r=[],c=i;c<=o;c++)r.push(c);return r},isPrevDisabled:function(){return 1===this.pagination.current},isNextDisabled:function(){return this.pagination.current*this.pagination.pageSize>=this.pagination.total}},methods:{prevPage:function(){this.pagination.current>1&&this.$emit("change",Object(_["a"])(Object(_["a"])({},this.pagination),{},{current:this.pagination.current-1}))},nextPage:function(){this.pagination.current*this.pagination.pageSize<this.pagination.total&&this.$emit("change",Object(_["a"])(Object(_["a"])({},this.pagination),{},{current:this.pagination.current+1}))},goToPage:function(t){this.$emit("change",Object(_["a"])(Object(_["a"])({},this.pagination),{},{current:t}))},addStudent:function(t){var e=this;this.createStudentFormVisible=!0,this.$nextTick((function(){e.$refs.addStudent.makeData(t)}))},addStudentClose:function(){this.createStudentFormVisible=!1},onChange:function(t,e,a,n){var s=n.currentDataSource;this.$emit("change",t,e,a,{currentDataSource:s})},reload:function(){}}},V=I,F=(a("3aa9"),Object(f["a"])(V,b,g,!1,null,"989f5c3a",null)),j=F.exports,O=[{title:"ID",dataIndex:"id",width:"10%"},{title:"课程编号",dataIndex:"sn",width:"10%"},{title:"课程名称",dataIndex:"course_name",width:"20%"},{title:"课程年月",dataIndex:"year_month",width:"10%"},{title:"课程费用",dataIndex:"fee",customRender:function(t){return(t/100).toFixed(2)+"元"},width:"10%"},{title:"创建时间",dataIndex:"create_at",sorter:!0,width:"15%"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"},width:"10%"}],P={name:"CourseList",computed:{form:function(){return this.$form.createForm(this,{name:"add_course"})}},components:{CourseListView:j,AddCourse:p},data:function(){return{advanced:!0,columns:O,rowKey:"id",dataSource:[],selectedRows:[],pagination:{current:1,pageSize:10,total:0},createCourseFormVisible:!1,createStudentFormVisible:!1,actionType:"create",formData:{}}},authorize:{deleteRecord:"delete"},mounted:function(){this.load()},methods:{load:function(){var t=this;Object(i["f"])("http://127.0.0.1:8000/api/course/list","get",{page:this.pagination.current,pageSize:this.pagination.pageSize}).then((function(e){var a,n,s=null!==(a=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data)&&void 0!==a?a:{},i=s.list,o=s.page,r=s.pageSize,c=s.total;t.dataSource=i,t.pagination.current=o,t.pagination.pageSize=r,t.pagination.total=c}))},reload:function(){this.load()},addCourseSuccess:function(){this.load()},remove:function(){var t=this;this.dataSource=this.dataSource.filter((function(e){return-1===t.selectedRows.findIndex((function(t){return t.key===e.key}))})),this.selectedRows=[]},onPageChange:function(t){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.load()},addNew:function(){var t=this;this.createCourseFormVisible=!0,this.$nextTick((function(){t.$refs.addCourse.open()}))},courseCreateClose:function(){this.createCourseFormVisible=!1}}},z=P,R=(a("2f12"),Object(f["a"])(z,n,s,!1,null,"625d5d11",null));e["default"]=R.exports},dd34:function(t,e,a){"use strict";var n=a("5214"),s=a.n(n);s.a}}]);